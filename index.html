<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Levels Academy – Registration Form</title>

<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/css/intlTelInput.css"/>

<style>
  :root{
    --field-bg:#f1f3f3;
    --label:#2b445b;
    --invalid:#fde7e7;
    --hover:#ADE2D7;
    --btn:#233e57;
    --btn-text:#fff;
    --radius:28px;
    --radius-sm:22px;
    --shadow:0 10px 22px rgba(0,0,0,.07);
  }
  *{box-sizing:border-box}
  html,body{margin:0}
  body{
    font-family:"Red Hat Display",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:transparent; color:#0f1f28;
  }
  .wrap{ width:min(1200px,100%); margin:0 auto; padding:22px 16px 28px; }

  form{
    display:grid;
    gap:20px 22px;
    grid-template-columns: repeat(12, 1fr);
  }

  .field label{
    display:block;
    font-weight:700; /* Bold titles */
    color:var(--label);
    font-size:14px;
    margin:0 0 8px;
  }
  .req::after{ content:" *"; color:#e05353; font-weight:800 }

  /* 30% thinner fields */
  .input, select, textarea{
    width:100%;
    border:none; outline:none;
    background:var(--field-bg);
    border-radius:var(--radius);
    padding:12px 20px;                /* thinner */
    font-size:16px;
    line-height:1.25;
    font-weight:300;                   /* Light inputs */
    transition: box-shadow .15s ease, background .15s ease;
  }
  .input:hover, select:hover, textarea:hover{ background:var(--hover); }  /* Hover to #ADE2D7 */
  .input:focus, select:focus, textarea:focus{
    box-shadow:0 0 0 3px rgba(35,184,153,.16);
    background:#eef1f1;
  }
  .invalid{ background:var(--invalid) !important; box-shadow:none !important; }

  /* Phone shell to match rounded bg */
  .phone-shell{
    background:var(--field-bg);
    border-radius:var(--radius);
    padding:8px 12px;                  /* thinner */
    transition: box-shadow .15s ease, background .15s ease;
  }
  .phone-shell:hover{ background:var(--hover); }
  .phone-shell:focus-within{
    box-shadow:0 0 0 3px rgba(35,184,153,.16);
    background:#eef1f1;
  }
  .phone{
    width:100%; border:none; background:transparent; outline:none;
    padding:6px 8px 6px 58px;          /* thinner */
    font-size:16px; font-weight:300;
  }

  /* Not resizable */
  textarea{ min-height:120px; border-radius:var(--radius-sm); resize:none; }

  /* ===== EXACT LAYOUT ===== */
  /* Row 1: 4 columns (3/12 each) */
  .first { grid-column: span 3; }
  .last  { grid-column: span 3; }
  .age   { grid-column: span 3; }
  .mail  { grid-column: span 3; }

  /* Row 2: 3 equal columns (4/12 each) */
  .phonec{ grid-column: span 4; }
  .branch{ grid-column: span 4; }
  .course{ grid-column: span 4; }

  /* Row 3: message spans 6; button spans 3, aligned to top of grey textarea */
  .msg      { grid-column: 1 / span 6; }
  .actions  { grid-column: 7 / span 3; display:flex; align-items:flex-start; padding-top:22px; } /* align to grey field top */
  .tailpad  { grid-column: 1 / -1; height: 1px; }

  /* Button: same height as fields, no outline ring, hover #ADE2D7 */
  button[type="submit"]{
    width:100%;
    background:var(--btn); color:var(--btn-text);
    border:none; padding:12px 20px;     /* same as inputs */
    font-size:16px; font-weight:800;
    border-radius:var(--radius);
    cursor:pointer;
    box-shadow:var(--shadow);           /* outline removed */
    transition: transform .08s ease, opacity .2s ease, background .15s ease;
  }
  button[type="submit"]:hover{ background:var(--hover); }
  button[type="submit"]:active{ transform:translateY(1px) }
  button[disabled]{ opacity:.6; cursor:progress }

  /* Success text shown after submit */
  .thanks{ color:var(--label); font-size:16px; display:none; align-self:flex-start; margin-left:0.5rem; }

  /* Native select chevrons */
  select{
    -webkit-appearance:none; -moz-appearance:none; appearance:none;
    background-image:
      linear-gradient(45deg, transparent 50%, #2b445b 50%),
      linear-gradient(135deg, #2b445b 50%, transparent 50%);
    background-position: calc(100% - 26px) calc(0.85em + 4px),
                         calc(100% - 20px) calc(0.85em + 4px);
    background-size:6px 6px, 6px 6px;
    background-repeat:no-repeat;
    padding-right:44px;
  }

  /* Responsive collapse */
  @media (max-width:1100px){
    .first,.last,.age,.mail{ grid-column: span 6; }
    .phonec,.branch,.course{ grid-column: span 6; }
    .msg{ grid-column: 1 / -1; }
    .actions{ grid-column: 1 / -1; padding-top:0; }
    button[type="submit"]{ width:100% }
  }
  @media (max-width:680px){
    form{ gap:16px }
    .first,.last,.age,.mail,
    .phonec,.branch,.course,
    .msg,.actions{ grid-column: 1 / -1; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <form id="enrollForm" novalidate>
      <!-- Row 1 -->
      <div class="field first">
        <label class="req" id="lbl-first">First name</label>
        <input class="input" id="firstName" name="firstName" autocomplete="given-name" required />
      </div>
      <div class="field last">
        <label class="req" id="lbl-last">Last name</label>
        <input class="input" id="lastName" name="lastName" autocomplete="family-name" required />
      </div>
      <div class="field age">
        <label class="req" id="lbl-age">Age</label>
        <input class="input" id="age" name="age" type="text" inputmode="numeric" required />
      </div>
      <div class="field mail">
        <label class="req" id="lbl-email">Email</label>
        <input class="input" id="email" name="email" type="email" autocomplete="email" required />
      </div>

      <!-- Row 2 -->
      <div class="field phonec">
        <label class="req" id="lbl-phone">Phone</label>
        <div class="phone-shell" id="phoneShell">
          <input id="phone" class="phone" name="phone" type="tel" required />
        </div>
      </div>
      <div class="field branch">
        <label class="req" id="lbl-branch">Branch</label>
        <select id="branch" name="branch" required></select>
      </div>
      <div class="field course">
        <label class="req" id="lbl-course">Course</label>
        <select id="course" name="course" required></select>
      </div>

      <!-- Row 3 -->
      <div class="field msg">
        <label id="lbl-message">Leave a message</label>
        <textarea id="message" name="message"></textarea>
      </div>

      <div class="actions">
        <button id="submitBtn" type="submit">Submit</button>
        <div id="thanks" class="thanks">Thanks, we received your submission.</div>
      </div>

      <div class="tailpad"></div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js"></script>
  <script>
    /* ---------- i18n dictionary ---------- */
    const i18n = {
      en: {
        labels: { first:'First name', last:'Last name', age:'Age', email:'Email', phone:'Phone', branch:'Branch', course:'Course', message:'Leave a message' },
        placeholders: { branch:'Select a branch', course:'Select a course' },
        options: {
          branches: ['Vake','Krtsanisi'],
          courses: [
            'Sunday School (age:6–10)',
            'Saturday School (age:6–10)',
            'General English for Children (age:6–10)',
            'IELTS',
            'General English for Teenagers (age: 11–17)',
            'Private Lessons',
            'FCE PET CAE',
            'Professional English',
            'General English for Adults'
          ]
        },
        button: 'Submit',
        thanks: 'Thanks, we received your submission.'
      },
      ka: {
        labels: { first:'სახელი', last:'გვარი', age:'ასაკი', email:'Email', phone:'ტელეფონი', branch:'ფილიალი', course:'კურსი', message:'დატოვეთ შეტყობინება' },
        placeholders: { branch:'აირჩიეთ ფილიალი', course:'აირჩიეთ კურსი' },
        options: {
          branches: ['ვაკე','კრწანისი'],
          courses: [
            'საკვირაო სკოლა (ასაკი: 6–10)',
            'შაბათის სკოლა (ასაკი: 6–10)',
            'ზოგადი ინგლისური ბავშვებისთვის (ასაკი: 6–10)',
            'IELTS',
            'ზოგადი ინგლისური მოზარდებისთვის (ასაკი: 11–17)',
            'ინდივიდუალური გაკვეთილები',
            'FCE PET CAE',
            'პროფესიული ინგლისური',
            'ზოგადი ინგლისური ზრდასრულთათვის'
          ]
        },
        button: 'გაგზავნა',
        thanks: 'გმადლობთ, თქვენი განაცხადი მივიღეთ.'
      }
    };

    function fillSelect(selectEl, placeholder, options){
      selectEl.innerHTML = '';
      const ph = document.createElement('option');
      ph.value = ''; ph.disabled = true; ph.selected = true; ph.textContent = placeholder;
      selectEl.appendChild(ph);
      options.forEach(text => {
        const op = document.createElement('option');
        op.textContent = text;
        selectEl.appendChild(op);
      });
    }

    function setLanguage(lang){
      const key = i18n[lang] ? lang : 'en';
      const t = i18n[key];

      // Labels
      document.getElementById('lbl-first').textContent   = t.labels.first;
      document.getElementById('lbl-last').textContent    = t.labels.last;
      document.getElementById('lbl-age').textContent     = t.labels.age;
      document.getElementById('lbl-email').textContent   = t.labels.email;
      document.getElementById('lbl-phone').textContent   = t.labels.phone;
      document.getElementById('lbl-branch').textContent  = t.labels.branch;
      document.getElementById('lbl-course').textContent  = t.labels.course;
      document.getElementById('lbl-message').textContent = t.labels.message;

      // Selects
      fillSelect(document.getElementById('branch'), t.placeholders.branch, t.options.branches);
      fillSelect(document.getElementById('course'), t.placeholders.course, t.options.courses);

      // Button + thanks
      document.getElementById('submitBtn').textContent = t.button;
      document.getElementById('thanks').textContent = t.thanks;

      // lang attr
      document.documentElement.setAttribute('lang', key);
    }

    // Read ?lang=... if present
    const urlLang = new URLSearchParams(location.search).get('lang') || 'en';
    setLanguage(urlLang);

    // Accept language updates from Wix via postMessage
    window.addEventListener('message', (event) => {
      if (event?.data?.type === 'set-lang') setLanguage(event.data.lang);
      if (event?.data?.type === 'please:resend-size') postSize();
    });

    /* ---------- phone input ---------- */
    const phoneEl = document.getElementById('phone');
    const iti = window.intlTelInput(phoneEl, {
      initialCountry: "ge",
      utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js",
      separateDialCode: true,
      preferredCountries: ["ge","tr","ae","gb"],
    });

    /* ---------- validation ---------- */
    const form = document.getElementById('enrollForm');
    const requiredSelectors = ['#firstName','#lastName','#age','#email','#branch','#course','#phone'];

    function setInvalid(el, on){
      if(el.id === 'phone'){
        document.getElementById('phoneShell').classList.toggle('invalid', on);
      }else{
        el.classList.toggle('invalid', on);
      }
    }
    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    // clear invalid while typing/selecting
    requiredSelectors.forEach(sel=>{
      const el = document.querySelector(sel);
      const clear = () => {
        if(el.id==='phone'){ if(iti.isValidNumber()) setInvalid(el,false); }
        else if(el.type==='select-one'){ if(el.value) setInvalid(el,false); }
        else { if(el.value.trim()!=='') setInvalid(el,false); }
      };
      el.addEventListener('input', clear);
      el.addEventListener('change', clear);
    });

    /* ---------- submit ---------- */
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      let anyInvalid = false;

      requiredSelectors.forEach(sel=>{
        const el = document.querySelector(sel);
        let bad=false;
        if(el.id==='phone'){ bad = !iti.isValidNumber(); }
        else if(el.type==='select-one'){ bad = !el.value; }
        else { bad = (el.value.trim()===''); }
        setInvalid(el, bad); anyInvalid = anyInvalid || bad;
      });

      const ageEl = document.getElementById('age');
      const age = ageEl.value.trim();
      if(isNaN(Number(age)) || Number(age)<3 || Number(age)>99){ setInvalid(ageEl,true); anyInvalid=true; }

      const emailEl = document.getElementById('email');
      if(!validEmail(emailEl.value.trim())){ setInvalid(emailEl,true); anyInvalid=true; }

      if(anyInvalid) return; // fields already pink

      const payload = {
        firstName: document.getElementById('firstName').value.trim(),
        lastName : document.getElementById('lastName').value.trim(),
        age      : age,
        email    : emailEl.value.trim(),
        phone    : iti.getNumber(),
        phoneCC  : iti.getSelectedCountryData()?.dialCode,
        branch   : document.getElementById('branch').value,
        course   : document.getElementById('course').value,
        message  : document.getElementById('message').value.trim(),
        lang     : document.documentElement.getAttribute('lang') || 'en',
        ts       : new Date().toISOString()
      };

      // Send to Wix page
      window.parent?.postMessage({ type: "levels-enroll", data: payload }, "*");

      // Success UI: hide button, show thanks message
      showThanks();

      // Reset fields (button stays hidden)
      form.reset();
      iti.setCountry("ge");
      requiredSelectors.forEach(sel=> setInvalid(document.querySelector(sel), false));
    });

    /* ---------- Auto-resize to parent (Wix) ---------- */
    function postSize() {
      const wrap = document.querySelector('.wrap');
      if (!wrap) return;
      const h = Math.ceil(wrap.offsetHeight);
      window.parent?.postMessage({ type: 'form:resize', height: h }, '*');
    }
    window.addEventListener('load', postSize);
    window.addEventListener('resize', postSize);
    new ResizeObserver(postSize).observe(document.querySelector('.wrap'));

    // Hook language change to resizing as well
    const _setLanguage = setLanguage;
    setLanguage = (...args) => { _setLanguage(...args); postSize(); };

    function showThanks(){
      const btn = document.getElementById('submitBtn');
      const thx = document.getElementById('thanks');
      if (btn) btn.style.display = 'none';
      if (thx) thx.style.display = 'block';
      postSize();
    }
  </script>
</body>
</html>
