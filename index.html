<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Corporate Course Registration</title>

<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/css/intlTelInput.css"/>

<style>
  :root{
    --form-h: 420px;                 /* desktop default (>900px) */
    --field-bg:#f1f3f3;
    --label:#2b445b;
    --invalid:#fde7e7;
    --hover:#ADE2D7;
    --btn:#233e57;
    --btn-text:#fff;
    --radius:28px;
    --radius-sm:22px;
    --shadow:0 10px 22px rgba(0,0,0,.07);
    --btn-offset-desktop: 32px;
    --btn-offset-tablet:  28px;
  }
  @media (max-width:900px){ :root{ --form-h: 680px; } }
  @media (max-width:650px){ :root{ --form-h: 950px; } }

  *{box-sizing:border-box}
  html,body{ margin:0; height:var(--form-h); }
  body{
    font-family:"Red Hat Display",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:transparent; color:#0f1f28; overflow:hidden;
  }

  .wrap{
    width:100%; margin:0; padding:22px 0 28px;
    height:var(--form-h); overflow:auto; will-change:transform;
  }

  form{
    display:grid; gap:20px 22px; grid-template-columns:repeat(12,1fr);
    align-items:start;
  }

  .field label{
    display:block; font-weight:700; color:var(--label);
    font-size:14px; margin:0 0 8px;
  }
  .req::after{ content:" *"; color:#e05353; font-weight:800 }

  .input, select, textarea{
    width:100%; border:none; outline:none; background:var(--field-bg);
    border-radius:var(--radius); padding:12px 20px; font-size:16px; font-weight:300;
    transition: box-shadow .15s ease, background .15s ease;
  }
  .input:hover, select:hover, textarea:hover{ background:var(--hover); }
  .input:focus, select:focus, textarea:focus{ box-shadow:0 0 0 3px rgba(35,184,153,.16); background:#eef1f1; }
  .invalid{ background:var(--invalid)!important; box-shadow:none!important; }

  .phone-shell{ background:var(--field-bg); border-radius:var(--radius); padding:8px 12px; transition: box-shadow .15s, background .15s; }
  .phone-shell:hover{ background:var(--hover); }
  .phone-shell:focus-within{ box-shadow:0 0 0 3px rgba(35,184,153,.16); background:#eef1f1; }
  .phone{ width:100%; border:none; background:transparent; outline:none; padding:6px 8px 6px 58px; font-size:16px; font-weight:300; }

  textarea{ min-height:120px; border-radius:var(--radius-sm); resize:none; }

  /* ===== EXACT LAYOUT (desktop) ===== */
  .first  { grid-column: span 3; }
  .last   { grid-column: span 3; }
  .mail   { grid-column: span 3; }
  .phonec { grid-column: span 3; }

  .org    { grid-column: span 3; }
  .industry{grid-column: span 3; }
  .group  { grid-column: 7 / span 6; }

  .msg     { grid-column: 1 / span 8; }
  .actions { grid-column: 9 / span 4; }

  .actions{
    align-self:start; display:flex; align-items:center; justify-content:center;
    padding-top:0; margin-top: var(--btn-offset-desktop);
  }

  .tailpad { grid-column: 1 / -1; height:1px; }

  button[type="submit"]{
    width:100%; background:var(--btn); color:var(--btn-text);
    border:none; padding:12px 20px; font-size:16px; font-weight:800;
    border-radius:var(--radius); cursor:pointer; box-shadow:var(--shadow);
    transition: transform .08s ease, opacity .2s ease, background .15s ease;
  }
  button[type="submit"]:hover{ background:var(--hover); color:#2B445B; }
  button[type="submit"]:active{ transform:translateY(1px) }
  button[disabled]{ opacity:.6; cursor:progress }

  .thanks{ color:var(--label); font-size:16px; display:none; align-self:flex-start; margin-left:.5rem; }

  select{
    -webkit-appearance:none; -moz-appearance:none; appearance:none;
    background-image:
      linear-gradient(45deg, transparent 50%, #2b445b 50%),
      linear-gradient(135deg, #2b445b 50%, transparent 50%);
    background-position: calc(100% - 26px) calc(0.85em + 4px),
                         calc(100% - 20px) calc(0.85em + 4px);
    background-size:6px 6px, 6px 6px;
    background-repeat:no-repeat; padding-right:44px;
  }

  @media (min-width:651px) and (max-width:900px){
    .first,.last,.mail,.phonec{ grid-column: span 6; }
    .org,.industry{ grid-column: span 6; }
    .group{ grid-column: 1 / -1; }
    .msg{ grid-column: 1 / -1; }
    .actions{ grid-column: 1 / -1; margin-top: var(--btn-offset-tablet); }
  }

  @media (max-width:650px){
    form{ gap:16px }
    .first,.last,.mail,.phonec,.org,.industry,.group,.msg,.actions{ grid-column: 1 / -1; }
    .actions{ margin-top: 0; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <form id="enrollForm" novalidate>
      <!-- Row 1 -->
      <div class="field first">
        <label class="req" id="lbl-first">First Name</label>
        <input class="input" id="firstName" name="firstName" autocomplete="given-name" required />
      </div>
      <div class="field last">
        <label class="req" id="lbl-last">Last Name</label>
        <input class="input" id="lastName" name="lastName" autocomplete="family-name" required />
      </div>
      <div class="field mail">
        <label class="req" id="lbl-email">Business Email</label>
        <input class="input" id="email" name="email" type="email" autocomplete="email" required />
      </div>
      <div class="field phonec">
        <label class="req" id="lbl-phone">Phone</label>
        <div class="phone-shell" id="phoneShell">
          <input id="phone" class="phone" name="phone" type="tel" required />
        </div>
      </div>

      <!-- Row 2 -->
      <div class="field org">
        <label class="req" id="lbl-org">Organisation name</label>
        <input class="input" id="org" name="org" required />
      </div>
      <div class="field industry">
        <label class="req" id="lbl-industry">Industry</label>
        <input class="input" id="industry" name="industry" required />
      </div>
      <div class="field group">
        <label class="req" id="lbl-group">Group Size</label>
        <select id="groupSize" name="groupSize" required></select>
      </div>

      <!-- Row 3 -->
      <div class="field msg">
        <label class="req" id="lbl-message">Leave a message</label>
        <textarea id="message" name="message" placeholder="Leave us a message..." required></textarea>
      </div>

      <div class="actions">
        <button id="submitBtn" type="submit">Submit</button>
        <div id="thanks" class="thanks">Thanks, we received your submission.</div>
      </div>

      <div class="tailpad"></div>
    </form>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js"></script>

  <!-- Firebase (CDN modules) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { initializeFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    /* === Firebase config === */
    const firebaseConfig = {
      apiKey: "AIzaSyB-vfjAb9matVnpO6BVc3xBoFHnT_xXfH0",
      authDomain: "levels-registration.firebaseapp.com",
      projectId: "levels-registration",
      storageBucket: "levels-registration.firebasestorage.app",
      messagingSenderId: "883788306190",
      appId: "1:883788306190:web:1da45dc034cca9edefa95f"
    };

    const app = initializeApp(firebaseConfig);
    // Reliable in Wix iframes
    const db  = initializeFirestore(app, { experimentalAutoDetectLongPolling: true, useFetchStreams: false });

    /* ===== i18n (EN / KA) ===== */
    const i18n = {
      en: {
        labels: {
          first:'First Name', last:'Last Name', email:'Business Email', phone:'Phone',
          org:'Organisation name', industry:'Industry', group:'Group Size', message:'Leave a message'
        },
        placeholders: { group:'Select a group size' },
        groups: [
          '1:1 Training for Employees','2 - 10','11 - 20','21 - 50','51 - 100',
          '101 - 200','201 - 500','501 - 1000','Not known'
        ],
        button:'Submit',
        thanks:'Thanks, we received your submission.'
      },
      ka: {
        labels: {
          first:'სახელი', last:'გვარი', email:'Business Email', phone:'ტელეფონი',
          org:'ორგანიზაციის დასახელება', industry:'ინდუსტრია', group:'ჯგუფის ზომა', message:'დატოვეთ შეტყობინება'
        },
        placeholders: { group:'აირჩიეთ ჯგუფის ზომა' },
        groups: [
          'თანამშრომლებისათვის 1:1 ტრენინგი','2 - 10','11 - 20','21 - 50','51 - 100',
          '101 - 200','201 - 500','501 - 1000','-'
        ],
        button:'რეგისტრაცია',
        thanks:'გმადლობთ, თქვენი განაცხადი მივიღეთ.'
      }
    };

    function fillSelect(el, placeholder, options){
      el.innerHTML = '';
      const ph = document.createElement('option');
      ph.value = ''; ph.disabled = true; ph.selected = true; ph.textContent = placeholder;
      el.appendChild(ph);
      options.forEach(txt => {
        const op = document.createElement('option');
        op.textContent = txt;
        el.appendChild(op);
      });
    }

    function setLanguage(lang){
      const key = i18n[lang] ? lang : 'en';
      const t = i18n[key];
      document.getElementById('lbl-first').textContent    = t.labels.first;
      document.getElementById('lbl-last').textContent     = t.labels.last;
      document.getElementById('lbl-email').textContent    = t.labels.email;
      document.getElementById('lbl-phone').textContent    = t.labels.phone;
      document.getElementById('lbl-org').textContent      = t.labels.org;
      document.getElementById('lbl-industry').textContent = t.labels.industry;
      document.getElementById('lbl-group').textContent    = t.labels.group;
      document.getElementById('lbl-message').textContent  = t.labels.message;
      document.getElementById('submitBtn').textContent    = t.button;
      document.getElementById('thanks').textContent       = t.thanks;
      fillSelect(document.getElementById('groupSize'), t.placeholders.group, t.groups);
      document.documentElement.setAttribute('lang', key);
    }

    // Default EN; Wix can override via postMessage
    setLanguage('en');

    // Receive language from Velo
    window.addEventListener('message', (e) => {
      let d = e.data;
      if (typeof d === 'string') { try { d = JSON.parse(d); } catch(_){} }
      if (d && d.type === 'set-lang') setLanguage(d.lang);
    });

    // Phone input
    const iti = window.intlTelInput(document.getElementById('phone'), {
      initialCountry: "ge",
      utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js",
      separateDialCode: true,
      preferredCountries: ["ge","tr","ae","gb"],
    });

    /* ===== validation + Firestore save ===== */
    const required = ['#firstName','#lastName','#email','#phone','#org','#industry','#groupSize','#message'];
    const validEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);

    function setInvalid(el, on){
      if(el.id === 'phone'){ document.getElementById('phoneShell').classList.toggle('invalid', on); }
      else { el.classList.toggle('invalid', on); }
    }

    required.forEach(sel=>{
      const el = document.querySelector(sel);
      const clear = () => {
        if(el.id==='phone'){ if(iti.isValidNumber()) setInvalid(el,false); }
        else if(el.tagName==='SELECT'){ if(el.value) setInvalid(el,false); }
        else { if((el.value||'').trim()!=='') setInvalid(el,false); }
      };
      el.addEventListener('input', clear);
      el.addEventListener('change', clear);
    });

    const form = document.getElementById('enrollForm');
    const btn  = document.getElementById('submitBtn');
    const thanks = document.getElementById('thanks');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      let bad = false;

      required.forEach(sel=>{
        const el = document.querySelector(sel);
        let invalid=false;
        if(el.id==='phone'){ invalid = !iti.isValidNumber(); }
        else if(el.id==='email'){ invalid = !validEmail(el.value.trim()); }
        else if(el.tagName==='SELECT'){ invalid = !el.value; }
        else { invalid = (el.value.trim()===''); }
        setInvalid(el, invalid); bad = bad || invalid;
      });

      if(bad) return;

      btn.disabled = true;

      try{
        const payload = {
          /* canonical form id for admin panel */
          form:   "CorporateRegistration",
          formId: "CorporateRegistration",

          lang: document.documentElement.lang || 'en',
          firstName: document.getElementById('firstName').value.trim(),
          lastName:  document.getElementById('lastName').value.trim(),
          email:     document.getElementById('email').value.trim(),
          phoneE164: iti.getNumber(),
          phoneCountry: iti.getSelectedCountryData()?.iso2 || null,

          org:       document.getElementById('org').value.trim(),
          industry:  document.getElementById('industry').value.trim(),
          groupSize: document.getElementById('groupSize').value,
          message:   (document.getElementById('message').value || '').trim(),

          /* corporate has no branch – normalize so panel displays cleanly */
          branch: "-",
          branchKey: "-",

          status: "action_required",
          createdAt: serverTimestamp()
        };

        await addDoc(collection(db, "submissions"), payload);

        // UI success
        btn.style.display = 'none';
        thanks.style.display = 'block';
        form.reset();
        iti.setCountry("ge");
        required.forEach(sel=> setInvalid(document.querySelector(sel), false));
      }catch(err){
        btn.disabled = false;
        alert("Submission failed. Please try again.\n\n" + (err?.message || err));
      }
    });
  </script>
</body>
</html>


